{
  "metadata": {
    "title": "Coordinator & Matching API Specification",
    "version": "1.0.0",
    "generatedBy": "frontend-team",
    "date": "2025-11-14"
  },

  "coreModels": [
    {
      "name": "Student",
      "description": "Represents a student account and profile.",
      "schema": {
        "id": "string (uuid or objectId)",
        "fullName": "string",
        "studentId": "string",
        "eduMail": "string",
        "personalEmail": "string",
        "phoneNumber": "string",
        "program": "string",
        "faculty": "string",
        "year": "number",
        "metadata": "object (free-form)"
      }
    },
    {
      "name": "Tutor",
      "description": "Represents a tutor with availability, expertise and workload.",
      "schema": {
        "id": "string",
        "fullName": "string",
        "tutorId": "string",
        "eduMail": "string",
        "email": "string",
        "expertise": "string[]",
        "maxLoad": "number",
        "currentLoad": "number",
        "availability": "object (calendar/time slots)",
        "profileSummary": "string"
      }
    },
    {
      "name": "Coordinator",
      "description": "Staff user who reviews and performs manual assignments.",
      "schema": {
        "id": "string",
        "fullName": "string",
        "staffId": "string",
        "email": "string",
        "role": "string",
        "department": "string"
      }
    },
    {
      "name": "SuggestionContext",
      "description": "Per-tab AI suggestion context stored client-side and persisted to audit with an assignment.",
      "schema": {
        "suggestionId": "string",
        "generatedAt": "ISO8601 timestamp",
        "rankedTutors": "Array of { tutorId, score, rationale }",
        "prompt": "string",
        "explanation": "string"
      }
    },
    {
      "name": "ManualAssignment",
      "description": "A record of a coordinator-created manual assignment (audit-safe).",
      "schema": {
        "id": "string",
        "studentId": "string",
        "tutorId": "string",
        "coordinatorId": "string",
        "reason": "string",
        "suggestionContext": "SuggestionContext | null",
        "createdAt": "ISO8601 timestamp"
      }
    },
    {
      "name": "AuditLog",
      "description": "Audit records for manual actions taken by coordinators and system events.",
      "schema": {
        "id": "string",
        "actorId": "string",
        "actorRole": "string",
        "action": "string",
        "resource": "string",
        "details": "object",
        "createdAt": "ISO8601 timestamp"
      }
    },
    {
      "name": "Conflict",
      "description": "A detected conflict affecting one or more requests (e.g., tutor double-booking).",
      "schema": {
        "id": "string",
        "type": "string (e.g. 'double_booking' | 'eligibility' | 'availability')",
        "tutor": "Tutor | null",
        "slot": "string (ISO time slot identifier)",
        "details": "string",
        "requests": "Array of StudentRequest objects { requestId, studentId, requestedAt, subject, preferredTimes }",
        "detectedAt": "ISO8601 timestamp",
        "metadata": "object"
      }
    }
    ,
    {
      "name": "QuizItem",
      "description": "A single quiz item/question returned by the quiz generator.",
      "schema": {
        "id": "string",
        "question": "string",
        "options": "string[]",
        "correctIndex": "number? (0-based index, optional if answers withheld)",
        "explanation": "string?",
        "source": "string (trusted-bank | ai-freeform)",
        "topic": "string",
        "difficulty": "string",
        "createdAt": "ISO8601 timestamp",
        "metadata": "object?"
      }
    },
    {
      "name": "Quiz",
      "description": "A generated quiz bundle containing meta and quiz items.",
      "schema": {
        "quizId": "string",
        "generatedAt": "ISO8601 timestamp",
        "topic": "string",
        "difficulty": "string",
        "questions": "Array<QuizItem>",
        "metadata": "object?"
      }
    }
  ],

  "endpoints": {
    "public": [
      {
        "method": "GET",
        "path": "/api/tutors",
        "summary": "List tutors (public fields)",
        "response": "200: [Tutor] (public view)"
      },
      {
        "method": "GET",
        "path": "/api/students/:id",
        "summary": "Get student public profile",
        "response": "200: Student"
      }
    ],

    "student": [
      {
        "method": "POST",
        "path": "/api/requests",
        "summary": "Create a tutoring request on behalf of a student",
        "request": {
          "studentId": "string",
          "subject": "string",
          "preferredTimes": "array"
        },
        "response": "201: { requestId }"
      }
      ,
      {
        "method": "POST",
        "path": "/api/ai/generate-quiz",
        "summary": "Generate quiz questions via AI or return bank questions (demo).",
        "request": {
          "topic": "string (required)",
          "difficulty": "string (e.g. 'Intro / warm-up'|'Medium exam-style'|'Hard / stress test')",
          "source": "string (trusted-bank | ai-freeform)",
          "count": "number (optional, default 3)",
          "options": { "includeAnswers": "boolean?", "seed": "string?" }
        },
        "response": "200: { quizId: string, generatedAt: string, questions: [QuizItem] }",
        "notes": "Demo server returns mock questions. In production, require authentication, rate-limiting, and possibly paid AI provider integration."
      }
    ],

    "tutor": [
      {
        "method": "GET",
        "path": "/api/tutors/:id/schedule",
        "summary": "Get tutor's schedule and current load",
        "response": "200: { availability, currentLoad }"
      }
    ],

    "coordinator": [
      {
        "method": "GET",
        "path": "/api/matching-suggestions",
        "summary": "Get matching suggestions for a student or batch. Returns ranked tutors and suggestion context.",
        "query": { "studentId": "string", "limit": "number" },
        "response": "200: { suggestions: [SuggestionContext] }"
      },
      {
        "method": "GET",
        "path": "/api/coord/student-requests",
        "summary": "List student requests scoped to coordinator's department/area",
        "query": { "department": "string?", "status": "string?" },
        "response": "200: [StudentRequest]"
      },
      {
        "method": "GET",
        "path": "/api/coord/pending-assign",
        "summary": "List pending assignment items requiring coordinator review",
        "response": "200: [PendingAssignItem]"
      },
      {
        "method": "POST",
        "path": "/api/assignments",
        "summary": "Persist a manual assignment and create an audit record (REQUIRED: coordinator reason).",
        "request": {
          "studentId": "string",
          "tutorId": "string",
          "coordinatorId": "string (server should derive from auth)",
          "reason": "string (required)",
          "suggestionContext": "SuggestionContext | null"
        },
        "response": "201: ManualAssignment",
        "notes": "Server MUST validate coordinator identity from auth token and persist suggestionContext atomically with the assignment for auditing."
      },
      {
        "method": "GET",
        "path": "/api/assignments/:id",
        "summary": "Fetch a manual assignment record (audit view)",
        "response": "200: ManualAssignment"
      },
      {
        "method": "GET",
        "path": "/api/conflicts",
        "summary": "List detected conflicts for coordinator triage",
        "query": { "department": "string?" },
        "response": "200: [Conflict]"
      }
      ,
      {
        "method": "GET",
        "path": "/api/coord/sessions",
        "summary": "Get list of sessions the coordinator manages",
        "query": { "department": "string?", "status": "string?" },
        "response": "200: [Session]",
        "notes": "Session object includes id, studentId, tutorId, datetime, status, notes."
      },
      {
        "method": "GET",
        "path": "/api/coord/tutors",
        "summary": "Get list of tutors scoped to coordinator's oversight",
        "query": { "department": "string?", "availability": "string?" },
        "response": "200: [Tutor]",
        "notes": "Used by coordinator UI to monitor tutor load, expertise and availability."
      }
    ],

    "departmentChair": [
      {
        "method": "GET",
        "path": "/api/dept/reports/performance",
        "summary": "Department performance reports (aggregated metrics)",
        "query": { "department": "string", "from": "timestamp?", "to": "timestamp?" },
        "response": "200: { metrics: object, series: array }"
      },
      {
        "method": "GET",
        "path": "/api/dept/feedback-dashboard",
        "summary": "Feedback dashboard data for department-level views",
        "query": { "department": "string", "period": "string?" },
        "response": "200: { feedbackSummary: object, trends: array }"
      }
    ],
    "studentAffairs": [
      {
        "method": "GET",
        "path": "/api/sa/reports/participation",
        "summary": "Get participation report data for Student Affairs",
        "query": { "department": "string?", "from": "timestamp?", "to": "timestamp?", "groupBy": "string?" },
        "response": "200: { series: array, summary: object }",
        "notes": "Accessible to Student Affairs role; optionally scoped by department or cohort. See FR-RPT.03."
      },
      {
        "method": "GET",
        "path": "/api/sa/eligibility",
        "summary": "Get eligibility rules and list of eligible students (e.g., scholarships)",
        "query": { "program": "string?", "year": "number?", "filter": "object?" },
        "response": "200: { rules: object, eligibleStudents: [Student] }",
        "notes": "Restricted to Student Affairs roles; returns both eligibility criteria and the computed eligible list."
      }
    ],

    "shared": [
      {
        "method": "POST",
        "path": "/api/exports",
        "summary": "Create an export job for reports (CSV/JSON).",
        "request": { "reportType": "string", "filters": "object", "format": "string? (csv|json)", "notifyUrl": "string?" },
        "response": "201: { jobId: string, status: string, url?: string }",
        "notes": "Centralized exports endpoint. Server must enforce RBAC: allow department-level export types for DepartmentChair, broader exports for StudentAffairs or Admin based on role. The endpoint queues a job and returns a job id; results are delivered via file URL or callback when ready."
      }
    ],

    "admin": [
      {
        "method": "POST",
        "path": "/api/tutors",
        "summary": "Create or bulk-import tutors (admin only)",
        "request": { "tutors": "[Tutor]" },
        "response": "201: { created: number }"
      },
      {
        "method": "GET",
        "path": "/api/audit-logs",
        "summary": "Query audit logs for manual assignments and coordinator actions (admin only)",
        "query": { "since": "timestamp", "actorId": "string?" },
        "response": "200: [AuditLog]",
        "notes": "Access restricted to ProgramAdmin/System Admin roles."
      }
    ]
  },

  "implementationNotes": {
    "authentication": "All coordinator endpoints MUST authorize and derive coordinatorId from session/JWT. Client-provided coordinatorId is only for demos and MUST be ignored in production.",
    "persistence": "ManualAssignment and AuditLog MUST be stored in durable storage. SuggestionContext should be saved as immutable blob alongside assignment for legal/audit traceability.",
    "concurrency": "When persisting assignments, implement optimistic checks or transaction semantics to avoid double-assignment race conditions.",
    "dataRetention": "Audit logs should be retained according to policy; consider write-once append-only storage for audit records."
  }
}
